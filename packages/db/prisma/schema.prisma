generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model post {
  id          Int          @id @default(autoincrement())
  title       String       @db.VarChar(255)
  description String?
  content     String
  created_at  DateTime     @default(now()) @db.Timestamptz(6)
  updated_at  DateTime     @updatedAt @db.Timestamptz(6)
  category    PostCategory
  image       String?      @db.VarChar(500)
  word_count  Int
  post_tags   post_tag[]

  @@index([id])
  @@index([category])
}

model tag {
  id            Int            @id @default(autoincrement())
  name          String         @unique @db.VarChar(100)
  post_tags     post_tag[]
  timeline_tags timeline_tag[]
}

model post_tag {
  post_id Int
  tag_id  Int
  post    post @relation(fields: [post_id], references: [id], onDelete: Cascade)
  tag     tag  @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@id([post_id, tag_id])
  @@index([tag_id])
}

model timeline {
  id            Int              @id @default(autoincrement())
  title         String           @db.VarChar(255)
  description   String
  category      TimelineCategory
  detail        String
  article       String?          @db.VarChar(100)
  playground    String?          @db.VarChar(100)
  created_at    DateTime         @default(now()) @db.Timestamptz(6)
  updated_at    DateTime         @updatedAt @db.Timestamptz(6)
  timeline_tags timeline_tag[]

  @@index([id])
  @@index([category])
  @@index([created_at])
}

model timeline_tag {
  timeline_id Int
  tag_id      Int
  tag         tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)
  timeline    timeline @relation(fields: [timeline_id], references: [id], onDelete: Cascade)

  @@id([timeline_id, tag_id])
  @@index([tag_id])
}

enum PostCategory {
  ANALYSIS
  CASE_STUDY
  OPINION
}

enum TimelineCategory {
  PERFORMANCE
  ARCHITECTURE
  FOUNDATION
  INFRASTRUCTURE
  EXPERIMENT
}
