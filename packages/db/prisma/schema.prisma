generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model post {
  id           Int                @id @default(autoincrement())
  title        String             @db.VarChar(255)
  category     PostCategory
  image        String?            @db.VarChar(500)
  created_at   DateTime           @default(now()) @db.Timestamptz(6)
  updated_at   DateTime           @updatedAt @db.Timestamptz(6)
  post_tags    post_tag[]
  translations post_translation[]

  // Legacy columns - to be removed after migration
  description String?
  content     String?
  word_count  Int?

  @@index([id])
  @@index([category])
}

model post_translation {
  id          Int     @id @default(autoincrement())
  post_id     Int
  locale      Locale
  description String?
  content     String
  word_count  Int
  post        post    @relation(fields: [post_id], references: [id], onDelete: Cascade)

  @@unique([post_id, locale])
  @@index([locale])
}

model tag {
  id            Int            @id @default(autoincrement())
  name          String         @unique @db.VarChar(100)
  post_tags     post_tag[]
  timeline_tags timeline_tag[]
}

model post_tag {
  post_id Int
  tag_id  Int
  post    post @relation(fields: [post_id], references: [id], onDelete: Cascade)
  tag     tag  @relation(fields: [tag_id], references: [id], onDelete: Cascade)

  @@id([post_id, tag_id])
  @@index([tag_id])
}

model timeline {
  id            Int                    @id @default(autoincrement())
  title         String                 @db.VarChar(255)
  category      TimelineCategory
  article       String?                @db.VarChar(100)
  playground    String?                @db.VarChar(100)
  created_at    DateTime               @default(now()) @db.Timestamptz(6)
  updated_at    DateTime               @updatedAt @db.Timestamptz(6)
  timeline_tags timeline_tag[]
  translations  timeline_translation[]

  // Legacy columns - to be removed after migration
  description String?
  detail      String?

  @@index([id])
  @@index([category])
  @@index([created_at])
}

model timeline_translation {
  id          Int      @id @default(autoincrement())
  timeline_id Int
  locale      Locale
  description String
  detail      String
  timeline    timeline @relation(fields: [timeline_id], references: [id], onDelete: Cascade)

  @@unique([timeline_id, locale])
  @@index([locale])
}

model timeline_tag {
  timeline_id Int
  tag_id      Int
  tag         tag      @relation(fields: [tag_id], references: [id], onDelete: Cascade)
  timeline    timeline @relation(fields: [timeline_id], references: [id], onDelete: Cascade)

  @@id([timeline_id, tag_id])
  @@index([tag_id])
}

enum PostCategory {
  ANALYSIS
  CASE_STUDY
  OPINION
}

enum TimelineCategory {
  PERFORMANCE
  ARCHITECTURE
  FOUNDATION
  INFRASTRUCTURE
  EXPERIMENT
}

enum Locale {
  ko
  en
}
